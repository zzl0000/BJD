<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="edge" />
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>爱尚抓娃娃后台管理系统</title>
		<link rel="stylesheet" href="../../Plugin/TuiComponent/TuiComponent.css"/>
		<!--重置样式表-->
		<link rel="stylesheet" href="../../Library/css/Reset-style.css" />
		<!--/重置样式表-->

		<link rel="stylesheet" href="../Library/css/Tui-Common.css" />

		<!--宽度大于1024px的时候加载PC端样式表-->
		<link rel="stylesheet" href="../Library/css/Tui-PC.css" media="screen and (min-width: 1024px)" />
		<!--/宽度大于1024px的时候加载PC端样式表-->

		<!--宽度小于1024px的时候加载移动端样式表-->
		<link rel="stylesheet" href="../Library/css/Tui-Mobile.css" media="screen and (max-width: 1024px)" />
		<!--/宽度小于1024px的时候加载移动端样式表-->
		
		<!--Font Awesome图标字体库(font-awesome.css)-->
		<link rel="stylesheet" href="../../Library/css/font-awesome.css"/>
		<!--/Font Awesome图标字体库(font-awesome.css)-->
		
		<!--Jquery前端开发框架,JS库-->
		<script src="../../Library/js/jquery-1.8.3.min.js"></script>
		<!--/Jquery前端开发框架,JS库-->
		
		<!--前端开发(doT.js)模板引擎-->
		<script src="../../Library/js/doT.js"></script>
		<!--/前端开发(doT.js)模板引擎-->
		
		<!--自定义TuiComponent组件,插件-->
		<script src="../../Plugin/TuiComponent/TuiComponent.js"></script>
		<!--/自定义TuiComponent组件,插件-->
		<link rel="stylesheet" href="../../Plugin/Pagination/jquery.pagination.css">
		<script src="../../Plugin/Pagination/jquery.pagination.min.js"></script>

		<script src="../../Library/js/vatCore.js"></script>
		
		<!--表单验证插件,JS-->
		<script src="../../Library/js/ValidateForm.js"></script>
		<!--/表单验证插件,JS-->
		
		<!--HTML5标签兼容JS-->

		<!--[if lt IE 9]>
		<script src="../../Library/js/html5shiv.js"></script>
		<script src="../../Library/js/respond.min.js"></script>
		<![endif]-->
	</head>
	
	<body>
		<!--主体内容-模块-->
		<div class="wrapper">
			<!--T_crumbsNav-->
			<nav class="T_crumbsNav">
				<ul>
					<li>
						<a href="favorite-Mange.html"><i class="fa fa-home"></i> 收藏管理</a>
					</li>
				</ul>
			</nav>
			<!--/T_crumbsNav-->
				
			<!--T_layout-->
			<section class="T_layout">
				<div class="rows">
					<div class="col-md-2 col-sm-12">
						<!--T_accordionMenu_ibox-->
						<div class="T_accordionMenu_ibox">
							<hgroup class="T_accordionMenu_item">
								<header data-toggle="accordionMenu" class="T_accordionMenu_title collectionType curActive " data-index="1" style="background-image: none;">娃娃收藏</header>
							</hgroup>
							<hgroup class="T_accordionMenu_item">
								<header data-toggle="accordionMenu" class="T_accordionMenu_title collectionType" data-index="2" style="background-image: none;">设备收藏</header>
							</hgroup>
						</div>
						<!--/T_accordionMenu_ibox-->
					</div>
					<div class="col-md-10 col-sm-12">
						<div class="T_ibox">
							<!--娃娃收藏列表-模块-->
							<div class="T_iboxContent" id="tab_1">
								<!--T_formSearchTool-->
								<form class="T_formSearchTool">
									<div class="T_rows">
										<hgroup class="T_inputSearch">
											<label>娃娃名称：</label>
											<input type="search" id="userId" placeholder="输入娃娃名称查询" />
											<span id="search1"><i class="fa fa-search"></i> 搜索</span>
										</hgroup>
									</div>
								</form>
								<!--/T_formSearchTool-->
								
								<!--T_tableResponsive-->
								<div class="T_tableResponsive">
									<table class="T_table T_tableBordered T_tableHover">
										<thead>
											<tr>
												<th class="col-md-2">用户名称</th>
												<th class="col-md-2">娃娃名称</th>
												<th class="col-md-2">收藏量</th>
												<th class="col-md-2">收藏时间</th>
											</tr>
										</thead>
										<tbody id="evaluationtmpl">

										</tbody>
                                        <script id="arraystmpl" type="text/x-dot-template">
                                            {{ for(var i in it.list) { }}
                                            <tr>
                                                <td>{{= it.list[i].nickName }}</td>
                                                <td>{{= it.list[i].name || '' }}</td>
                                                <td>
                                                    <label class="T_label T_labelS">{{= it.list[i].collectionNum || '0' }}</label>
                                                </td>
                                                <td>{{= it.list[i].collectionTime }}</td>
                                            </tr>
                                            {{ } }}

                                        </script>

									</table>
								</div>
								<!--/T_tableResponsive-->
								<!--T_pageToolbar-->
								<div id="pagination3" class="page fl"></div>
								<!--/T_pageToolbar-->
							</div>
							<!--/娃娃收藏列表-模块-->
							
							<!--设备收藏列表-模块-->
							<div class="T_iboxContent T_hide" id="tab_2">
								<!--T_formSearchTool-->
								<form class="T_formSearchTool">
									<div class="T_rows">
										<hgroup class="T_inputSearch">
											<label>设备名称：</label>
											<input type="search"  placeholder="输入设备名称查询" />
											<span id="search2"><i class="fa fa-search"></i> 搜索</span>
										</hgroup>
									</div>
								</form>
								<!--/T_formSearchTool-->
								
								<!--T_tableResponsive-->
								<div class="T_tableResponsive">
									<table class="T_table T_tableBordered T_tableHover">
										<thead>
											<tr>
												<th class="col-md-3">用户名称</th>
												<th class="col-md-5">设备名称</th>
												<th class="col-md-2">收藏量</th>
												<th class="col-md-2">收藏时间</th>
											</tr>
										</thead>
										<tbody id="evaluationtmpl2">

										</tbody>
                                        <script id="arraystmpl2" type="text/x-dot-template">
                                            {{ for(var i in it.list) { }}
                                            <tr>
                                                <td>{{= it.list[i].nickName }}</td>
												<td>{{= it.list[i].name || '' }}</td>
                                                <td>
                                                    <label class="T_label T_labelS">{{= it.list[i].collectionNum || '0' }}</label>
                                                </td>
                                                <td>{{= it.list[i].collectionTime }}</td>
                                            </tr>
                                            {{ } }}

                                        </script>
									</table>
								</div>
								<!--/T_tableResponsive-->

								<!--T_pageToolbar-->
								<div id="pagination4" class="page fl"></div>
								<!--/T_pageToolbar-->
							</div>
							<!--/设备收藏列表-模块-->
						</div>
					</div>
				</div>
			</section>
			<!--/T_layout-->
		</div>
		<!--/主体内容-模块-->
		
		<!--Web弹层组件-(添加)发送的消息-->
		<section class="T_modalWrap" id="add_MsgModal">
			<div class="T_modalIbox">
				<div class="T_modalBody">
					<form class="T_formIbox">
						<div class="T_rows">
							<hgroup class="T_textareaText">
								<label>消息内容：</label>
								<div>
									<textarea id="textareaVal" rows="5" placeholder="输入消息内容" datatype="IsNull" dataCount="20" errorMsg="消息内容不能为空！"></textarea>
									<em class="T_textCount"><b>0</b>/20个字符</em>
								</div>
							</hgroup>
						</div>
					</form>
				</div>
				<footer class="T_modalFooter">
					<button class="T_confirmBtn">提交</button>
				</footer>
			</div>
		</section>
		<!--/Web弹层组件-(添加)发送的消息-->
		
		<script>
			

			
			$(document).ready(function() {
                var _num = 0,collectionType,userId;

                //打开(添加)发送的消息-弹窗层
                $('body').off('click').on('click','.add_MsgBtn',function() {
                    var id = $(this).data('id');

                   Tui.Page({
                        type: 0,
                        title: '添加消息',
                        content: $('#add_MsgModal'),
                        success: function(btnIndex) {
                            var content = $('#textareaVal').val();

                            addMes(id,content)
                        }
                    });
                });

                function addMes(id,content) {
                    console.log(id,content);

                    $.ajax({
                        type: "post",
                        url: "http://120.77.83.200:8088/sms/insertSms",
                        data: {
                            id:id,
                            content:content
                        },
                        success: function (rs) {
                            if (rs.desc == "成功") {
                                Tui.Msg({text:'添加成功', icon:'sIcon'});
                                $('#add_MsgModal').hide();
                                getOrderList(_num,collectionType);
                            } else {
                                Tui.Msg({text:rs.desc, icon:'sIcon'});
                            }
                            //console.log(rs.message);
                        }
                    });
                }
                $('.collectionType').click(function(){
                    collectionType = $(this).data('index');
                    getOrderList(_num,collectionType);
                });
                $('#search1').click(function () {
                    userId = $(this).siblings('input').val();
                    //collectionType = 1;
                    getOrderList(_num,collectionType,userId);
                });
                $('#search2').click(function () {
                    //collectionType = 2;
                    userId = $(this).siblings('input').val();
                    getOrderList(_num,collectionType,userId);
                });

                getOrderList(_num,collectionType);
                //  获取 订单列表列表

                function getOrderList(_num,collectionType,_userId) {
                    var data ={
                        collectionType:collectionType || 1,
                        num :_num,
                        size :'5',
                        userId:_userId || ''
                    };
                    $.ajax({
                        type: "post",
                        url: "http://120.77.83.200:8088/back/collection/selectCollectionList",
                        headers: {
                            'access-token':sessionStorage.getItem('token').replace(/^\"|\"$/g,'')
                        },
                        data: data,
                        success: function (rs) {
                            if (rs.desc == "成功") {
                                if(collectionType == 2){
                                    var arrText2 = doT.template($("#arraystmpl2").text())(rs.result);
                                    $('#evaluationtmpl2').html(arrText2);
                                    paginael(rs.result);
                                }else{
                                    paginael(rs.result);
                                    var arrText = doT.template($("#arraystmpl").text())(rs.result);
                                    $('#evaluationtmpl').html(arrText);
                                }

                            } else {
                                Tui.Msg({text:rs.desc, icon:'sIcon'});
                            }
                            //console.log(rs.message);
                        }
                    });
                }

                function paginael(rs) {

                    $("#pagination3").pagination({
                        currentPage: rs.pageNum,
                        totalPage: rs.pages,
                        isShow: true,
                        count: 5,
                        homePageText: "首页",
                        endPageText: "尾页",
                        prevPageText: "上一页",
                        nextPageText: "下一页",
                        callback: function(current) {

                            getBjdList(current);
                        }
                    });
                }


				
				/**
				 * 左侧导航菜单-事件
				 */
				$('[data-toggle=accordionMenu]').click(function() {
					var index = $(this).attr('data-index')
					
					$('[data-toggle=accordionMenu]').removeClass('curActive')
					
					$(this).addClass('curActive')
					
					if (index == '1') { //1.娃娃收藏
						$('#tab_2').addClass('T_hide')
						$('#tab_1').removeClass('T_hide')
					} else if (index == '2') { //2.设备收藏
						$('#tab_1').addClass('T_hide')
						$('#tab_2').removeClass('T_hide')
					}
				})
				
			})
		</script>
		
	</body>
</html>
