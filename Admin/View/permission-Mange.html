<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="edge" />
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>爱尚抓娃娃后台管理系统</title>
	<link rel="stylesheet" href="../../Plugin/TuiComponent/TuiComponent.css"/>
	<!--重置样式表-->
	<link rel="stylesheet" href="../../Library/css/Reset-style.css" />
	<!--/重置样式表-->

	<link rel="stylesheet" href="../Library/css/Tui-Common.css" />

	<!--宽度大于1024px的时候加载PC端样式表-->
	<link rel="stylesheet" href="../Library/css/Tui-PC.css" media="screen and (min-width: 1024px)" />
	<!--/宽度大于1024px的时候加载PC端样式表-->

	<!--宽度小于1024px的时候加载移动端样式表-->
	<link rel="stylesheet" href="../Library/css/Tui-Mobile.css" media="screen and (max-width: 1024px)" />
	<!--/宽度小于1024px的时候加载移动端样式表-->

	<!--Font Awesome图标字体库(font-awesome.css)-->
	<link rel="stylesheet" href="../../Library/css/font-awesome.css"/>
	<!--/Font Awesome图标字体库(font-awesome.css)-->

	<!--Jquery前端开发框架,JS库-->
	<script src="../../Library/js/jquery-1.8.3.min.js"></script>
	<!--/Jquery前端开发框架,JS库-->

	<!--前端开发(doT.js)模板引擎-->
	<script src="../../Library/js/doT.js"></script>
	<!--/前端开发(doT.js)模板引擎-->

	<!--自定义TuiComponent组件,插件-->
	<script src="../../Plugin/TuiComponent/TuiComponent.js"></script>
	<!--/自定义TuiComponent组件,插件-->

	<link rel="stylesheet" href="../../Plugin/Pagination/jquery.pagination.css">
	<script src="../../Plugin/Pagination/jquery.pagination.min.js"></script>

	<script src="../../Library/js/vatCore.js"></script>

	<!--表单验证插件,JS-->
	<script src="../../Library/js/ValidateForm.js"></script>
	<!--/表单验证插件,JS-->

	<!--HTML5标签兼容JS-->

	<!--[if lt IE 9]>
	<script src="../../Library/js/html5shiv.js"></script>
	<script src="../../Library/js/respond.min.js"></script>
	<![endif]-->
</head>

<body>
<!--主体内容-模块-->
<div class="wrapper">
	<!--T_crumbsNav-->
	<nav class="T_crumbsNav">
		<ul>
			<li>
				<a href="role-Mange.html"><i class="fa fa-home"></i> 角色管理</a>
			</li>
		</ul>

		<hgroup class="T_toolBtnGroup">
			<a class="T_btn T_btnI add_RoleBtn"><i class="fa fa-plus"></i> 添加权限</a>
		</hgroup>
	</nav>
	<!--/T_crumbsNav-->

	<!--T_layout-->
	<section class="T_layout">
		<div class="T_ibox">
			<div class="T_iboxContent">
				<!--T_formSearchTool-->
				<form class="T_formSearchTool">
					<div class="T_rows">
						<hgroup class="T_inputSearch">
							<label>权限名称：</label>
							<input type="search" id="_roleName" placeholder="输入权限名称查询" />
							<span id="search"><i class="fa fa-search"></i> 搜索</span>
						</hgroup>
					</div>
				</form>
				<!--/T_formSearchTool-->

				<!--T_tableResponsive-->
				<div class="T_tableResponsive">
					<table class="T_table T_tableBordered T_tableHover">
						<thead>
						<tr>
							<th class="col-md-1">序号</th>
							<th class="col-md-1">权限名称</th>
							<th class="col-md-1">创建时间</th>
							<th class="col-md-1">操作</th>
						</tr>
						</thead>
						<tbody id="evaluationtmpl">

						</tbody>
						<script id="arraystmpl" type="text/x-dot-template">
							{{ for(var i in it.list) { }}
							<tr>
								<td>{{= i }} </td>
								<td>{{= it.list[i].anthName }}</td>
								<td>{{= it.list[i].createTime }}</td>
								<td>
									<a class="T_btn T_btnSm T_btnP add_RoleBtn" data-id="{{= it.list[i].id }}"><i class="fa fa-edit"></i> 修改</a>
									<!--<a class="T_btn T_btnSm T_btnI change_PwsdBtn" data-id="{{= it.list[i].id }}"><i class="fa fa-edit"></i> 更改密码</a>-->
									<a class="T_btn T_btnSm T_btnD del_Btn" data-id="{{= it.list[i].id }}"><i class="fa fa-trash-o"></i> 删除</a>
								</td>

							</tr>
							{{ } }}

						</script>

					</table>
				</div>
				<!--/T_tableResponsive-->
				<!--T_pageToolbar-->
				<div id="pagination3" class="page fl"></div>
				<!--/T_pageToolbar-->
			</div>

		</div>
	</section>
	<!--/T_layout-->
</div>
<!--/主体内容-模块-->

<!--Web弹层组件-(添加 || 修改)角色-->
<section class="T_modalWrap" id="add_RoleModal">
	<div class="T_modalIbox">
		<div class="T_modalBody">
			<form class="T_formIbox">
				<div class="T_rows">
					<hgroup class="T_inputText">
						<label>权限名称：</label>
						<input type="text" id="menuName" placeholder="输入名称" datatype="IsNull" errorMsg="不能为空！" />
					</hgroup>
				</div>

				<div class="clearfix"></div>
				<div class="T_rows">
					<hgroup class="T_radio">
						<label>是否启用：</label>
						<div class="radio-control" datatype="Radio" errorMsg="不能为空！">
							<label class="curActive" data-value="0">是</label>
							<label data-value="1">否</label>
						</div>
					</hgroup>
				</div>
				<div class="clearfix"></div>
				<div class="T_ibox m_t_md" style="margin-bottom: 0;">
					<header class="T_iboxTitle" style="padding: 0 0; border-bottom: none;"><h5>菜单分配</h5></header>
					<div class="T_iboxContent" style="padding: 0;">
						<!--T_tableResponsive-->
						<div class="T_tableResponsive" style="padding-bottom: 0;">
							<table class="T_table T_tableBordered T_tableHover">
								<tbody>
								<tr id="columnTypeList">

								</tr>
								</tbody>
							</table>
						</div>
						<!--/T_tableResponsive-->
					</div>
				</div>
			</form>
		</div>
		<footer class="T_modalFooter">
			<button class="T_confirmBtn">提交</button>
		</footer>
	</div>
</section>
<!--/Web弹层组件-(添加 || 修改)角色-->

<script>





    $(document).ready(function() {
        var _num = 0,_menuName;

        // 搜索

        $('#search').click(function () {
            _menuName = $('#_roleName').val();
            getOrderList(_num,_menuName);
        });

        /**
         * 渲染菜单列表
         **/
        getMenuList()
        function getMenuList() {

            $.ajax({
                type: "get",
                url: "http://120.77.83.200:8088/back/sMenu/selectMenuAllById",
                headers: {
                    'access-token':sessionStorage.getItem('token').replace(/^\"|\"$/g,'')
                },
                success: function (rs) {
                    if (rs.desc == "成功") {

                        var html = '';
                        var data = rs.result;
                        for(var i = 0; i< data.length; i++){
                            html += '<td><div class="checkbox-control"><label class="curActive" data-value="'+data[i].id+'">'+ data[i].menuName +'</label></div></hgroup></td>';
                        }

                        $('#columnTypeList').html(html);
                        $('.checkbox-control').vatCheck();

                    } else {
                        Tui.Msg({text: rs.desc, icon: 'sIcon'});
                    }
                    //console.log(rs.message);
                }
            });
        }


        ///back/sMenu/selectMenuAllById

        getOrderList(_num,_menuName);
        //  获取 权限列表

        function getOrderList(_num,_menuName) {
            var data ={
                num :_num,
                size :'5',
                search:_menuName || '',
            };
            $.Call.Ajax({
                type: "get",
                url: "http://120.77.83.200:8088/back/sAuth/selectAuthListByPageByThis",
                headers: {
                    'Access-Token':sessionStorage.getItem('token')
                },
                params: data,
                success: function (rs) {
                    if (rs.desc == "成功") {
                        paginael(rs.result);
                        var arrText = doT.template($("#arraystmpl").text())(rs.result);
                        $('#evaluationtmpl').html(arrText);
                    } else {
                        Tui.Msg({text:rs.desc, icon:'sIcon'});
                    }
                    //console.log(rs.message);
                },
				error:function(){

				}
			});

        }


        //打开(添加 || 修改)角色-弹窗层


        $('body').on('click','.add_RoleBtn',function() {
            var ids = $(this).data('id');
            //console.log(ids);
            Tui.Page({
                type: 0,
                title: '添加/修改-权限',
                content: $('#add_RoleModal'),
                success: function(btnIndex) {
                    var  data ={
                        id:ids ||'',
                        anthName :$('#menuName').val(),
                        isUsing :$('.curActive').data('value')
                    };
                    addMenu(data);
                }
            });
        });


        $('#columnTypeList1 li').on('click',function(){
            var level = $(this).data('value');
            console.log(level);
            if(level == 1){
                $('#parentMenuId').hide();
            }else{
                $('#parentMenuId').show();
            }

        });



        // 删除
        $('body').on('click','.del_Btn',function() {
            var ids = $(this).data('id');

            $.ajax({
                type: "get",
                url: "http://120.77.83.200:8088/back/sAuth/deleteAuthByIds",
                headers: {
                    'access-token':sessionStorage.getItem('token').replace(/^\"|\"$/g,'')
                },
                data: {ids:ids},
                success: function (rs) {
                    if (rs.desc == "成功") {
                        Tui.Msg({text:rs.desc, icon:'sIcon'})
                        getOrderList(_num);
                    } else {
                        Tui.Msg({text:rs.desc, icon:'sIcon'});
                    }
                }
            });

        });

        function addMenu(data){
            $.ajax({
                type: "post",
                url: "http://120.77.83.200:8088/back/sAuth/insertOrUpdateAuth",

                headers: {
                    'Access-Token':sessionStorage.getItem('token')
                },
                data: JSON.stringify(data),
                contentType: 'application/json',
                success: function (rs) {
                    if (rs.desc == "成功") {
                        Tui.Msg({text:rs.desc, icon:'sIcon'})
                        Tui.closeAll($('#add_RoleModal'));
                        getOrderList(_num);
                    } else {
                        Tui.Msg({text:rs.desc, icon:'sIcon'});
                    }
                    //console.log(rs.message);
                }
            });
        }

        function paginael(rs) {

            $("#pagination3").pagination({
                currentPage: rs.pageNum,
                totalPage: rs.pages,
                isShow: true,
                count: 10,
                homePageText: "首页",
                endPageText: "尾页",
                prevPageText: "上一页",
                nextPageText: "下一页",
                callback: function(current) {

                    getOrderList(current,_menuName);
                }
            });
        }

    })
</script>

</body>
</html>
